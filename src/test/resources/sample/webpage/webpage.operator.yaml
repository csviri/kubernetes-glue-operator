apiVersion: io.csviri.operator.resourceglue/v1beta1
kind: GlueOperator
metadata:
  name: webpage-operator
spec:
  parent:
    apiVersion: resourceglueoperator.sample/v1  # watches all the custom resource of type WebPage
    kind: WebPage
  resources:
    - name: html-config-map
      resource:
        apiVersion: v1
        kind: ConfigMap
        metadata:
          name: "{{parent.metadata.name}}"  # the parent resource (target webpage instance) can be referenced as "parent"
        data:
          index.html: "{{{parent.spec.html}}}"
    - name: deployment
      resource:
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          name: "{{parent.metadata.name}}"
        spec: # details omitted
            spec:
              containers:
                - name: nginx
                  image: nginx:1.17.0
                  volumeMounts:
                    - name: html-volume
                      mountPath: /usr/share/nginx/html
              volumes:
                - name: html-volume
                  configMap:
                    name: "{{parent.metadata.name}}"
    - name: service
      resource:
        apiVersion: v1
        kind: Service
        metadata:
          name: "{{parent.metadata.name}}"
        spec: # Omitted details
    - name: ingress
      condition:
        type: JSCondition
        script: |
          parent.spec.exposed == "true";
      resource:
        apiVersion: networking.k8s.io/v1
        kind: Ingress
        metadata:
          name: "{{parent.metadata.name}}"
      # Omitted Details

